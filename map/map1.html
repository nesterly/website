<!DOCTYPE html>
<html>
<head>
	<title>Leaflet Map</title>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
</head>
<body>
	<!-- Our web map and content will go here -->
	<div id="map" style="width: 705px; height: 375px"></div>
	<div id="controls" style="margin: 15px;">
		<div id="controls" style="margin: 15px;">
		    <button id="addButton">Show All Coffee Shops</button>
		    <button id="removeButton">Hide All Coffee Shops</button>
		    <button id="toggleButton">Toggle All Coffee Shops</button>
		    <button id="filterSBux">Starbucks</button>
		</div>
	</div>
	<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
	<script>
		// set coffee shop dataset to variable coffeeShops
		var coffeeShops = {
		    "type": "FeatureCollection",
		    "features": [
		        {
		            "type": "Feature",
		            "properties": {
		                "name": "Dunkin Donuts",
		                "address": "1 Broadway #1, Cambridge, MA 02142",
		                "latitude": 42.362504,
		                "longitude": -71.083372
		            },
		            "geometry": {
		                "type": "Point",
		                "coordinates": [-71.083372, 42.362504]
		            }
		        },
		        {
		            "type": "Feature",
		            "properties": {
		                "name": "Starbucks",
		                "address": "6 Cambridge Center, Cambridge, MA 02142",
		                "latitude": 42.363884,
		                "longitude": -71.087749
		            },
		            "geometry": {
		                "type": "Point",
		                "coordinates": [-71.087749, 42.363884]
		            }
		        }
		    ]
		};

    	// Create web map object
    	var map = L.map('map',{
    		center: [42.362432, -71.086086],
    		zoom: 14 }
    	);

    	// Add tile layer for Open Street Map to map object
    	L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', { attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>' }).addTo(map);

    	// Disable double click
		map.doubleClickZoom.disable();

		// set coffeeShopPoints to a our coffeeShop GeoJSON
		var coffeeShopPoints = L.geoJson(coffeeShops, {
		    onEachFeature: function (feature, layer) {
		        layer.bindPopup(feature.properties.name);
		    }
		});

		// create an empty popup element
		var popup = L.popup();

		// write a function that will populate the popup element using methods from the popup object
		function onMapClick(e) {
		    popup
		        .setLatLng(e.latlng)
		        .setContent("You clicked the map at " + e.latlng.toString())
		        .openOn(map);
		}

		// on click, run function to populate popup and open it on the map
		map.on('click', onMapClick);

		// Create event listener for the Add Coffee Shops Button
		document.getElementById("addButton").addEventListener("click", addCoffeeShops);

		// add coffee shops function
		function addCoffeeShops() {
		    coffeeShopPoints.addTo(map);
		};

		// Create event listener for the Add Coffee Shops Button
		document.getElementById("removeButton").addEventListener("click", removeCoffeeShops);

		// remove coffee shops function
		function removeCoffeeShops() {
		    map.removeLayer(coffeeShopPoints);
		};

		document.getElementById("toggleButton").addEventListener("click", toggleCoffeeShops);

		// Toggle Coffee Shops
		function toggleCoffeeShops(){
		    if(map.hasLayer(coffeeShopPoints)){
		        removeCoffeeShops();
		    } else {
		        addCoffeeShops();
		    }
		};

		// Event Listener for a click on the Starbucks button
		document.getElementById("filterSBux").addEventListener("click", filterSBux);

		// Function to update coffeeShopPoints to filtered subset of data showing Starbucks
		function filterSBux(){
		    if(map.hasLayer(coffeeShopPoints)){
		    removeCoffeeShops();
		    };
		    coffeeShopPoints = L.geoJson(coffeeShops,{
		        onEachFeature: function (feature, layer) {
		            layer.bindPopup(feature.properties.name);
		        }, filter: function (feature, layer) {
		            return feature.properties.name == "Starbucks";
		        }
		    }).addTo(map);
		}

		// Add the filtered GeoJSON element to our Map
		starbucksPoints.addTo(map)

	</script>
</body>
</html>